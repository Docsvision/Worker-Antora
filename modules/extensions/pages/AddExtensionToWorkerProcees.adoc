= Добавление расширения в конфигурацию Рабочего процесса

Разработанное расширение необходимо добавить в конфигурацию Рабочего процесса, в котором данное расширение будет использоваться. Расширение может быть подключено к новому или существующему РП.

Далее приведена инструкция по подключению расширения к новому РП. Все описанные действия выполняются в реестре ОС сервера, на котором установлена Служба рабочих процессов – стандартная реализация способа хранения конфигурации Службы.

. Зарегистрируйте расширение в конфигурации:

. Создайте подраздел с произвольным именем в разделе:

** `HKLM\SOFTWARE\DocsVision\WorkerService\5.5\Components` – для расширения типа «Компонент»;
** `HKLM\SOFTWARE\DocsVision\WorkerService\5.5\Connections` – для расширения типа «Фабрика подключений»;
** `HKLM\SOFTWARE\DocsVision\WorkerService\5.5\Queues` – для расширения типа «Фабрика очередей»;
** `HKLM\SOFTWARE\DocsVision\WorkerService\5.5\Tasks` – для расширения типа «Фабрика задач».
. В параметре «по умолчанию» созданного раздела укажите полное имя класса разработанного Расширения. Например: `SomeExtension.SomeComponent, SomeExtension, Version=1.0.0.0, Culture=neutral, PublicKeyToken=12fee43f4c59c5ea`.

. Для расширений типа «Фабрика очередей сообщений», «Компонент», «Фабрика подключений» добавьте в созданный раздел строковый параметр с настройками экземпляра Расширения:

** Имя параметра – произвольное имя для экземпляра расширения. Имя должно быть уникальным в пределах всего раздела настроек (`Components`, `Connections`, `Queues` или `Tasks`) данного типа расширений.
** Значение параметра – строка с настройками экземпляра расширения. В значении может быть указана, например, строка подключения к БД, адрес сервиса или учетные данные пользователя.
. Создайте _Роль рабочего процесса_, по которой РП будет получать разработанное Расширение или перейдите к следующему шагу, если требуемая _Роль_ существует. 

Для создания _Роли рабочего процесса_ создайте подраздел с произвольным именем в разделе `HKLM\SOFTWARE\DocsVision\WorkerService\5.5\Roles`. Например: `HKLM\SOFTWARE\DocsVision\WorkerService\5.5\Components\NewRole`.

. Включите разработанное Расширение в Роль:

. Создайте в ветке Роли (`HKLM\SOFTWARE\DocsVision\WorkerService\5.5\Components\NewRole` – из примера выше) строковый параметр с названием:

** «Components» – если добавляется _Компонент_;
** «Connections» – если добавляется «Фабрика подключений»;
** «Queues» – если добавляется «Фабрика очередей»;
** «Tasks» – если добавляется «Фабрика задач».
. В значении параметра укажите:

** для расширений «Фабрика очередей сообщений», «Компонент», «Фабрика подключений» – название экземпляра Расширения, предоставляемого Роли. Из примера выше: «Instance».

image:img/componentInRoleRegistryConfig.png[Настройки Роли]

** для расширения «Фабрика очередей сообщений» – название подраздела расширения в `HKLM\SOFTWARE\DocsVision\WorkerService\5.5\Queues`.

. Зарегистрируйте новый РП с созданной _Ролью_:

. Создайте подраздел с произвольным именем в разделе `HKLM\SOFTWARE\DocsVision\WorkerService\5.5\WorkerProcesses`. Например: `HKLM\SOFTWARE\DocsVision\WorkerService\5.5\WorkerProcesses\BestProcess`.

. Добавьте в созданный раздел параметры:

** «Architecture» с типом DWORD и значением «1» (архитектура – x86);
** «Disabled» с типом DWORD и значением «0»;
** «Roles» строкового типа – в значении должно быть указано название _Роли_ РП. Название Роли – название подраздела, в котором определена Роль (в примере – «NewRole»).

​